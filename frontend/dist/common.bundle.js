(()=>{var c={API_BASE_URL:"https://smartcart-ecommerce.vercel.app"};async function g(s,e){try{return(await fetch(`${c.API_BASE_URL}/autoMail`,{method:"post",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({...s,emailType:e})})).status}catch(t){console.log(t)}}function r(s,e){e.innerHTML=`<p>${s}</p>`,e.classList.add("show"),setTimeout(()=>{e.classList.remove("show")},5e3)}async function p(s,e){try{let t=await fetch(`${c.API_BASE_URL}/createOrder`,{method:"post",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({totalAmount:s})}),i=await t.json();if(console.log(i),t.status===401){r("You must login in order to proceed with checkout!",e),setTimeout(()=>{window.location.href="userRegistration.html?class=login"},6e3);return}let{customerName:a,email:n}=i.customerInfo,d={key:"rzp_test_AO71JIUm27dfec",amount:`${i.amount}`,currency:"INR",name:"SmartCart",description:"Test Transaction",order_id:`${i.orderId}`,callback_url:"https://eneqd3r9zrjok.x.pipedream.net/",prefill:{name:`${a}`,email:`${n}`},notes:{address:"Razorpay Corporate Office"},theme:{color:"#007bff"},handler:async function(w){let m=await fetch(`${c.API_BASE_URL}/verifyOrder`,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({...w,orderId:m.orderId})});m.status===200?r("Payment successful! Thank you for your order.",e):m.status===400&&r("Payment verification failed. Please contact support.",e)}};new Razorpay(d).open()}catch(t){console.log(t)}}function u(s,e){let t=s.length;if(t===0){e.innerHTML='<p>Cart is empty!</p><button id="cartExitBtn" class="exitBtns"><i class="fa-solid fa-xmark"></i></button>';return}let i=s.reduce((a,n)=>a+n.price*n.quantity,0);return i=Math.round(i*100)/100,e.innerHTML=`<h4>Your Cart[${t} items]</h4><button id="cartExitBtn" class="exitBtns"><i class="fa-solid fa-xmark"></i></button><div id="cartItemList"></div><div id="orderSummary"><p>subtotal : ${i}</p><button class="cartBtnHover" id="checkoutBtn">Checkout</button></div>`,s.forEach(a=>{let n=document.querySelector("#cartItemList");S(a,n)}),i}function S(s,e){let t=document.createElement("article");t.setAttribute("id",`article${s.id}`),t.setAttribute("class","cartItems"),t.innerHTML=`<img src="./images/serum.webp" alt="${s.name}">
  <h3>${s.name}</h3>
  <p>${s.price} Rs</p>
  <div id="quantityBtns">
  <button class="increaseBtns btns">+</button>
  <p id="quantity${s.id}">${s.quantity}</p>
  <button class="decreaseBtns btns">-</button>
  </div>
  <button class="removeBtns btns"><i class="fa-solid fa-xmark"></i></button>`,e.append(t)}function f(s,e){if(s.length===0){e.innerHTML='<p>Cart is empty!</p><button id="wishlistExitBtn" class="exitBtns"><i class="fa-solid fa-xmark"></i></button>';return}e.innerHTML='<h4>Your Wishlist</h4><button id="wishlistExitBtn" class="exitBtns"><i class="fa-solid fa-xmark"></i></button><div id=wishlistItemList></div>',s.forEach(t=>{let i=document.getElementById("wishlistItemList");B(t,i)})}function B(s,e){let t=document.createElement("article");t.setAttribute("id",`${s.id}`),t.innerHTML=`<img src="./images/serum.webp" alt="${s.name}">
  <p>${s.name}</p>
  <p>${s.price}</p>
  <button class="removeBtns"><i class="fa-solid fa-xmark"></i></button>`,e.append(t)}var o=JSON.parse(localStorage.getItem("cart"))||[];function h(s){o=o.filter(e=>e.id!==s),localStorage.setItem("cart",JSON.stringify(o))}function y(s){o.forEach(e=>{e.id===s&&(e.quantity+=1)}),localStorage.setItem("cart",JSON.stringify(o))}function v(s,e){e>1?o.forEach(t=>{t.id===s&&(t.quantity-=1)}):(o=o.filter(t=>t.id!==s),h(s)),localStorage.setItem("cart",JSON.stringify(o))}var l=JSON.parse(localStorage.getItem("wishlist"))||[];function I(s,e){console.log(s),console.log("removing..."),l=l.filter(t=>t.id!==s),localStorage.setItem("wishlist",JSON.stringify(l)),console.log(l),e&&(e.classList.remove("fas"),e.classList.add("far"))}var b=document.querySelector(".notificationPopup");document.addEventListener("DOMContentLoaded",()=>{L("header.html","headerPlaceholder",x),L("footer.html","footerPlaceholder",A)});function L(s,e,t){fetch(s).then(i=>i.text()).then(i=>{document.getElementById(e).innerHTML=i,t&&t()}).catch(i=>console.error(`Error loading ${s}:`,i))}var x=()=>{E(),k(),$()},E=()=>{document.getElementById("menu").addEventListener("click",function(){document.querySelector(".nav-links").classList.toggle("active")})},$=()=>{let s=document.getElementById("wishlist"),e=document.getElementById("wishlistPopup"),t=JSON.parse(localStorage.getItem("wishlist"));Array.isArray(t)||(t=[]),s.addEventListener("click",()=>{t=JSON.parse(localStorage.getItem("wishlist")),e.style.display="flex",overlay.classList.add("active"),f(t,e)}),e.addEventListener("click",i=>{if(i.target.classList.contains("removeBtns")||i.target.closest(".removeBtns")){let a=i.target.closest("article").id;I(a)}t=JSON.parse(localStorage.getItem("wishlist")),f(t,e),(i.target.classList.contains("exitBtns")||i.target.closest(".exitBtns"))&&(e.style.display="none",overlay.classList.remove("active"))})},k=()=>{let s=document.getElementById("cart"),e=document.getElementById("cartPopup"),t=JSON.parse(localStorage.getItem("cart"))||[];Array.isArray(t)||(t=[]);let i=0;s.addEventListener("click",()=>{t=JSON.parse(localStorage.getItem("cart"))||[],e.style.display="flex",overlay.classList.add("active"),i=u(t,e)}),e.addEventListener("click",a=>{t=JSON.parse(localStorage.getItem("cart"))||[];let n=a.target.parentElement.parentElement.id.split("article")[1];if(a.target.classList.contains("increaseBtns"))y(n);else if(a.target.classList.contains("decreaseBtns")){let d=document.querySelector(`#quantity${n}`).textContent;v(n,d)}else(a.target.classList.contains("removeBtns")||a.target.closest(".removeBtns"))&&h(n);t=JSON.parse(localStorage.getItem("cart"))||[],i=u(t,e),(a.target.classList.contains("exitBtns")||a.target.closest(".exitBtns"))&&(e.style.display="none",overlay.classList.remove("active")),a.target.id==="checkoutBtn"&&p(i,b)})},A=()=>{N(),C()},N=()=>{document.getElementById("backToTop").addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})})},C=async()=>{document.getElementById("newsletterForm").addEventListener("submit",async e=>{e.preventDefault();let t=e.target.email.value;await g({email:t},"newsletter")===422&&r("Provided email address is non-existent! Recheck your email address.",notificationPopup),r('Thank you for subscribing! You"ll now receive the latest updates and exclusive offers directly in your inbox.',b)})};})();
